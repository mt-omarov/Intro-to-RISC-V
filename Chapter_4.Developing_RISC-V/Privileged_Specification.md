# Привилегированная спецификация
 
## Обзор
Как следует из названия, привилегированная спецификация содержит описания RISC-V ISA, которые работают в машинном режиме (M-mode) 
или режиме супервизора (S-mode). Эти режимы имеют повышенные привилегии и поэтому описаны в совершенно отдельном документе от 
базового ISA и стандартных расширений. Эта спецификация также содержит дополнительные функциональные возможности, необходимые 
для запуска богатых операционных систем, таких как Linux.

В первой части каждой главы спецификации привилегий подробно описаны регистры управления и состояния (CSR), доступ к которым возможен только из M- и S-режима. 
Мы не будем рассматривать эти детали здесь, а сосредоточимся на других деталях, специфичных для этих двух режимов.

## ISA машинного уровня (M-Mode), версия 1.11
В этой главе описаны функции машинного уровня, доступные в машинном режиме (М-режиме). 
Режим M используется для низкоуровневого доступа к аппаратной платформе и является первым режимом, который включается при сбросе, 
когда процессор завершает инициализацию и готов к выполнению кода. М-режим также может использоваться для реализации функций, 
которые слишком сложно или дорого реализовать в аппаратном обеспечении напрямую. Хорошим примером может служить сторожевой таймер, 
реализованный в низкоуровневом программном обеспечении (микропрограмме), который помогает системе восстанавливаться после сбоев. 
Мы рассмотрим три важные особенности режима M, описанные в спецификации: немаскируемые прерывания, атрибуты физической памяти и защита физической памяти.

## Немаскируемые прерывания (NMI)
Немаскируемые прерывания (NMI) используются только в условиях аппаратных ошибок. 
При срабатывании они вызывают немедленный переход к обработчику NMI, работающему в M-режиме, независимо от того, 
как установлен бит разрешения прерывания для этого аппаратного потока. Другими словами, это прерывание 
будет обслуживаться без возможности заблокировать его в конфигурации. Каждый NMI будет иметь связанный с ним регистр "mcause". 
Это позволяет реализаторам решать, как они хотят обрабатывать эти прерывания, и позволяет им определять множество возможных причин. 
NMI не сбрасывают состояние процессора, что позволяет диагностировать, сообщать и, возможно, локализовать аппаратную ошибку.

## Атрибуты физической памяти (PMA)
Физическая карта памяти системы включает в себя такие диапазоны адресов, как: области памяти, управляющие регистры с привязкой к памяти и 
пустые дыры в адресном пространстве. Некоторые области памяти могут не поддерживать чтение, запись или выполнение; 
некоторые могут не поддерживать доступ к подслову или подблоку; некоторые могут не поддерживать атомарные операции; 
а некоторые могут не поддерживать когерентность кэша или иметь различные модели памяти. В системах RISC-V эти свойства и 
возможности каждого региона физического адресного пространства машины называются атрибутами физической памяти (PMA).

PMA некоторых областей памяти фиксируются во время проектирования микросхемы - например, для ПЗУ на кристалле. 
Другие фиксируются во время проектирования платы, в зависимости, например, от того, какие другие микросхемы подключены к внечиповым шинам. 
Некоторые устройства могут быть конфигурируемыми во время выполнения для поддержки различных применений, которые подразумевают 
различные PMA - например, оперативная память на кристалле может быть частным кэшем одного ядра в одном конечном приложении, или доступ к ней
как к общей некэшируемой памяти в другом конечном приложении. В большинстве систем потребуется, чтобы по крайней мере некоторые PMA 
динамически проверялись аппаратно на более поздних этапах конвейера выполнения после того, как будет известен физический адрес, поскольку 
некоторые операции не будут поддерживаться по всем физическим адресам памяти, а некоторые операции требуют знания текущей настройки конфигурируемого атрибута PMA.

Для RISC-V мы выделяем спецификацию и проверку PMA в отдельную аппаратную структуру, "PMA checker". 
Во многих случаях атрибуты известны на этапе проектирования системы для каждой области физического адреса и могут быть жестко подключены к устройству проверки PMA. Если атрибуты настраиваются во время выполнения, могут быть предусмотрены специфические для платформы регистры управления с привязкой к памяти для задания этих атрибутов с гранулярностью, соответствующей каждой области на платформе (например, для статической памяти с произвольным доступом (SRAM) на кристалле, которая может быть гибко разделена между кэшируемым и некэшируемым использованием).

Детали PMA легко могли бы занять целую главу этого курса. Мы не будем рассматривать PMA с упорядочиванием памяти, 
PMA с идемпотентностью, PMA с когерентностью или PMA с возможностью кэширования. Детали PMA подробно описаны в разделе 3.5 [Привилегированной спецификации](https://riscv.org/technical/specifications/). 
Опытные пользователи могут захотеть ознакомиться с этим разделом.

## Технические характеристики не-ISA
Целевые группы также могут работать над программным обеспечением или стандартами, которые не являются частью ISA. 
Например, следующие группы работают над проектами, которые не приводят к написанию спецификаций, а скорее стандартов, 
которые поощряют сообщества разрабатывать свои продукты на общей основе:
- Debug Task Group, работающая над поддержкой внешней отладки и стандартами.
- Целевая группа по соответствию работает над тестами и рамками соответствия RISC-V ISA.
- Целевая группа по структуре конфигурации работает над тем, как представить структуру конфигурации данной аппаратной реализации как в человекочитаемом формате, так и в двоичном формате.
